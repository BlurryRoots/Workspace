#!/bin/bash

# entry point

# change this to your liking
export CONFIGURATION_PATH="$HOME/Workspace/Config"

# set guard
export CONFIGURATION_LOADED=yes

workspace_config_plugin () {
	if ((2 != $#)); then
		echo "no plugin name provided"
		return 1
	fi

	pushd "$CONFIGURATION_PATH/plugins/$2" > /dev/null
	case "$1" in
		"install" )
			if [ -e "install" ] && ./install
			;;
		"init" )
			if [ -e "init" ] && source init
			;;
	esac
	popd > /dev/null

	return 0
}

# define function to reinitialize
workspace_config_load () {
	# setup dotfiles
	source "$CONFIGURATION_PATH/link-dotfiles"

	# setup options
	source "$CONFIGURATION_PATH/options"

	# setup aliases
	source "$CONFIGURATION_PATH/aliases"

	# setup exports
	source "$CONFIGURATION_PATH/exports"

	# setup helper functions
	source "$CONFIGURATION_PATH/functions"

	# import additional functionality
	source "$CONFIGURATION_PATH/imports"
	
	# iterate through all active plugins and initialize their additinal features
	touch "$CONFIGURATION_PATH/plugins/activated"
	for plugin in $(cat "$CONFIGURATION_PATH/plugins/activated"); do
		workspace_config_plugin init "$plugin"
	done
}

# and call it
workspace_config_load
